{% extends "portal/base.html" %}
{% block title %}Staff Dashboard{% endblock %}
{% block content %}

<div class="container-fluid mt-4">

    <h2 class="mb-4 text-center text-success fw-bold">
        ğŸ“Š Academic Control Dashboard
    </h2>

    <!-- ================= SUMMARY CARDS ================= -->

    <div class="row g-4 mb-4">

        <div class="col-md-3">
            <div class="card shadow-sm border-success text-center h-100">
                <div class="card-body">
                    <h6 class="text-muted">Total Students</h6>
                    <h2 class="fw-bold text-success">{{ total_students }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-primary text-center h-100">
                <div class="card-body">
                    <h6 class="text-muted">Total Courses</h6>
                    <h2 class="fw-bold text-primary">{{ total_courses }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-warning text-center h-100">
                <div class="card-body">
                    <h6 class="text-muted">Total Semesters</h6>
                    <h2 class="fw-bold text-warning">{{ total_semesters }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-dark text-center h-100">
                <div class="card-body">
                    <h6 class="text-muted">Total Results</h6>
                    <h2 class="fw-bold text-dark">{{ total_results }}</h2>
                </div>
            </div>
        </div>

    </div>

    <!-- ================= ACTION BUTTONS ================= -->

    <div class="text-center mb-5">
        <a href="{% url 'portal:add_result' %}" class="btn btn-primary mx-2">â• Add Result</a>
        <a href="{% url 'portal:upload_results' %}" class="btn btn-success mx-2">ğŸ“‚ Upload CSV</a>
        <a href="{% url 'portal:download_results_template' %}" class="btn btn-outline-secondary mx-2">â¬‡ Template</a>
        <a href="{% url 'admin:index' %}" class="btn btn-dark mx-2">âš™ Admin</a>
    </div>

    <!-- ================= RECENT STUDENTS ================= -->

    <h4 class="mb-3">ğŸ‘¨â€ğŸ“ Recent Students</h4>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Reg Number</th>
                    <th>Name</th>
                    <th>Program</th>
                    <th>Year</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ student.reg_number }}</td>
                    <td>{{ student.user.get_full_name }}</td>
                    <td>{{ student.program }}</td>
                    <td>{{ student.year }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center text-muted">
                        No students found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- STUDENTS PAGINATION -->
    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            {% if students.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?student_page={{ students.previous_page_number }}">
                        Previous
                    </a>
                </li>
            {% endif %}

            <li class="page-item active">
                <span class="page-link">
                    Page {{ students.number }} of {{ students.paginator.num_pages }}
                </span>
            </li>

            {% if students.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?student_page={{ students.next_page_number }}">
                        Next
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>

    <!-- ================= RECENT RESULTS ================= -->

    <h4 class="mt-5 mb-3">ğŸ“Š Recent Results</h4>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Student</th>
                    <th>Course</th>
                    <th>Semester</th>
                    <th>Marks</th>
                    <th>Grade</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for result in recent_results %}
                <tr>
                    <td>{{ result.student.user.get_full_name }}</td>
                    <td>{{ result.course.name }}</td>
                    <td>{{ result.semester.name }}</td>
                    <td>{{ result.marks }}</td>
                    <td>{{ result.grade_letter }}</td>
                    <td>
                        {% if result.locked %}
                            <span class="badge bg-dark">Locked</span>
                        {% elif result.approved %}
                            <span class="badge bg-success">Approved</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Pending</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center text-muted">
                        No results available.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- RESULTS PAGINATION -->
    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            {% if recent_results.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?results_page={{ recent_results.previous_page_number }}">
                        Previous
                    </a>
                </li>
            {% endif %}

            <li class="page-item active">
                <span class="page-link">
                    Page {{ recent_results.number }} of {{ recent_results.paginator.num_pages }}
                </span>
            </li>

            {% if recent_results.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?results_page={{ recent_results.next_page_number }}">
                        Next
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>

</div>

{% endblock %}